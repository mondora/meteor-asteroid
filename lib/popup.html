<html>
	<head>
		<script>
			// The value of the following variables will be
			// replaced if no error occurs.
			// If an error occurs, they'll remeain "TOKEN" and
			// "SECRET".
			var credentialToken = "TOKEN";
			var credentialSecret = "SECRET";
			var allowedOrigins = "ALLOWED_ORIGINS";
			// Replacing will occur on exactly the words TOKEN and SECRET.
			// So to check if it was replaced or not, we split the word TOKEN
			// in TOKE + N, so that it will not be replaced, but the string value
			// will remain TOKEN.
			if (credentialToken !== "TOKE" + "N") {
				try {
					window.opener.Package.oauth.OAuth._handleCredentialSecret(credentialToken, credentialSecret);
					window.close()
				} catch (e) {
					window.addEventListener("message", function (e) {
						var a = document.createElement("a");
						a.href = e.origin;
						var origin = a.hostname;
						var message;
						try {
							message = JSON.parse(e.data);
						} catch (err) {
							return;
						}
						if (
							message.credentialToken === credentialToken &&
							allowedOrigins.indexOf(origin) !== -1
						) {
							var response = JSON.stringify({
								credentialToken: credentialToken,
								credentialSecret: credentialSecret
							});
							e.source.postMessage(response, e.origin);
							window.close();
						}
					});
				}
			} else {
				window.close()
			}
		</script>
	</head>
</html>
