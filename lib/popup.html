<html>
	<head>
		<script>
			// The value of the following variables will be
			// replaced if no error occurs.
			var credentialToken = "TOKEN";
			var credentialSecret = "SECRET";
			var allowedOrigin = "ALLOWED_ORIGIN";
			// Write the two tokens in the hash fragment
			// To simplify parsing, we'll adopt the
			// convention TOKEN&SECRET 
			window.location.hash = credentialToken + "&" + credentialSecret;
			if (credentialToken !== "TOKEN") {
				try {
					window.opener.Package.oauth.OAuth._handleCredentialSecret(credentialToken, credentialSecret);
					window.close();
				} catch (e) {
					window.addEventListener("message", function (e) {
						var message;
						try {
							message = JSON.parse(e.data);
						} catch (err) {
							return;
						}
						if (
							message.credentialToken === credentialToken &&
							allowedOrigin.indexOf(e.origin) !== -1
						) {
							var response = JSON.stringify({
								credentialToken: credentialToken,
								credentialSecret: credentialSecret
							});
							e.source.postMessage(response, e.origin);
							window.close();
						}
					});
				}
			} else {
				try {
					window.opener.Package.oauth.OAuth._handleCredentialSecret;
					window.close();
				} catch (e) {
					window.addEventListener("message", function (e) {
						if (allowedOrigin.indexOf(e.origin) !== -1) {
							var response = JSON.stringify({
								error: "ERROR"
							});
							e.source.postMessage(response, e.origin);
							window.close();
						}
					});
				}
			}
		</script>
	</head>
</html>
